'use strict';var _slicedToArray=function(){function c(e,f){var g=[],h=!0,j=!1,k=void 0;try{for(var m,l=e[Symbol.iterator]();!(h=(m=l.next()).done)&&(g.push(m.value),!(f&&g.length===f));h=!0);}catch(o){j=!0,k=o}finally{try{!h&&l['return']&&l['return']()}finally{if(j)throw k}}return g}return function(e,f){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return c(e,f);throw new TypeError('Invalid attempt to destructure non-iterable instance')}}(),_typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(c){return typeof c}:function(c){return c&&'function'==typeof Symbol&&c.constructor===Symbol&&c!==Symbol.prototype?'symbol':typeof c};(function(c,e){'function'==typeof define&&define.amd?define([],e):'object'===('undefined'==typeof module?'undefined':_typeof(module))&&module.exports?module.exports=e():c.aggro=e()})(void 0,function(){function c(){function m(t){var u=t.filter(function(v){for(var w=0;w<o.length;w++){var x=o[w],y=x.key?e(v[x.key]):v;if(x.test){if(!x.test(y,v[x.key]))return!1;}else if('<='===x.type){if(y>x.value)return!1;}else if('>='===x.type){if(y<x.value)return!1;}else if('>'===x.type){if(y<=x.value)return!1;}else if('<'===x.type){if(y>=x.value)return!1;}else if('in'===x.type){var z=x.value;if(1===z.length){if(z[0]!==y)return!1;}else if(-1===z.indexOf(y))return!1}}return!0});if(null!=q){var v=new Map,w='function'==typeof q?q:function(x){return x[q]};u.forEach(function(x){var y=w(x),z=w(x).valueOf(),A=v.get(z);A?A.values.push(x):v.set(z,{key:y,values:[x]})}),u=Array.from(v.values())}else u=[{key:null,values:u}];return u=u.map(function(v){for(var w=function _loop(x){var y=_slicedToArray(p[x],4),z=y[0],A=y[1],B=y[2],C=y[3],D=B(v.values.map(function(E){return E[z]}).filter(function(E){return void 0!==E}));v[A]=C?C(D):D},x=0;x<p.length;x++)w(x);return v}),r&&u.sort(function(v,w){return r(e(v.key),e(w.key))}),u}var o=[],p=[],q=null,r=null;return m.filter=function(t,u){if('object'===('undefined'==typeof t?'undefined':_typeof(t)))o.push(t);else if('function'==typeof t&&!u)o.push({key:null,type:'eq',test:t});else{if('function'!=typeof u&&void 0!==u){var v=e(u);u=function test(w){return w===v}}u?o.push({key:t,type:'eq',test:u}):console.warn('Aggro.filter was called without any filter created!')}return m},m.in=function(t,u){var v=(Array.isArray(u)?u:[u]).filter(f);return v.length&&m.filter({key:t,type:'in',value:k(v).map(e)}),m},m.between=function(t,u){var v=null,w=null;if(!Array.isArray(u))return m.filter(t,u);if(1===u.length)return m.filter(t,u[0]);if(2===u.length){var x=_slicedToArray(u,2);v=x[0],w=x[1]}else if(2<u.length){var y=j(u.filter(function(A){return null!=A})),z=_slicedToArray(y,2);v=z[0],w=z[1]}return null!=v&&m.filter({key:t,type:'>=',value:v}),null!=w&&m.filter({key:t,type:'<=',value:w}),m},m.aggregate=function(t,u,v){var w=3<arguments.length&&void 0!==arguments[3]?arguments[3]:'aggr_'+t;return p.push([t,w,u,'function'==typeof v?v:null]),m},m.sortKeys=function(t){return r='function'==typeof t?t:t||void 0===t?l:null,m},m.sum=function(t,u){var v=2<arguments.length&&void 0!==arguments[2]?arguments[2]:'sum_'+t;return m.aggregate(t,function(w){return w.reduce(function(x,y){return x+y},0)},u,v)},m.mean=function(t,u){var v=2<arguments.length&&void 0!==arguments[2]?arguments[2]:'mean_'+t;return m.aggregate(t,function(w){return w.reduce(function(x,y){return x+y},0)/w.length},u,v)},m.uniq=function(t,u){var v=2<arguments.length&&void 0!==arguments[2]?arguments[2]:'uniq_'+t;return m.aggregate(t,k,u,v)},m.count=function(t,u){var v=2<arguments.length&&void 0!==arguments[2]?arguments[2]:'count_'+t;return m.aggregate(t,function(w){return k(w).length},u,v)},m.min=function(t,u){var v=2<arguments.length&&void 0!==arguments[2]?arguments[2]:'min_'+t;return m.aggregate(t,g,u,v)},m.max=function(t,u){var v=2<arguments.length&&void 0!==arguments[2]?arguments[2]:'max_'+t;return m.aggregate(t,h,u,v)},m.range=function(t,u){var v=2<arguments.length&&void 0!==arguments[2]?arguments[2]:'range_'+t;return m.aggregate(t,j,u,v)},m.one=function(t,u){var v=2<arguments.length&&void 0!==arguments[2]?arguments[2]:t;return m.aggregate(t,function(w){return w[0]},u,v)},m.groupBy=function(t){return q=t,m},m.copy=function(){var t=c().groupBy(q);return o.forEach(function(u){return t.filter(u)}),p.forEach(function(u){return t.aggregate(u[0],u[2],u[3],u[1])}),t.sortKeys(r),t},m.data=m,m}var e=function normalize(m){return m?m.valueOf():m},f=function defined(m){return m!==void 0},g=function min(m){for(var o=void 0,p=0;p<m.length;p++)(void 0==o||m[p]<o)&&(o=m[p]);return o},h=function max(m){for(var o=void 0,p=0;p<m.length;p++)(void 0==o||m[p]>o)&&(o=m[p]);return o},j=function extent(m){for(var o=void 0,p=void 0,q=0;q<m.length;q++)(void 0==o||m[q]>o)&&(o=m[q]),(void 0==p||m[q]<p)&&(p=m[q]);return[p,o]},k=function uniq(m){var o=[],p=[];return m.forEach(function(q){var r=e(q);-1===o.indexOf(r)&&(o.push(r),p.push(q))}),p},l=function collate(m,o){return m<o?-1:m>o?1:m>=o?0:NaN};return c});

